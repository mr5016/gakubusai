<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>èª¿ç†å ´ | å­¦éƒ¨ç¥­</title>
  <script defer src="/__/firebase/12.4.0/firebase-app-compat.js"></script>
  <script defer src="/__/firebase/12.4.0/firebase-auth-compat.js"></script>
  <script defer src="/__/firebase/12.4.0/firebase-firestore-compat.js"></script>
  <script defer src="/__/firebase/init.js?useEmulator=true"></script>

  <link href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#fff7ed; --paper:#ffffff; --ink:#3f2817; --muted:#8b5e34;
      --accent:#fb923c; --accent-strong:#f97316; --ring:#fdba74; --soft:#ffedd5;
    }
    *{box-sizing:border-box}
    body{
      margin:0; padding:24px; color:var(--ink);
      font-family: "M PLUS Rounded 1c", system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Noto Sans JP", "Yu Gothic", Meiryo, sans-serif;
      background:
        radial-gradient(900px 520px at 0% -10%, #ffe7c7 0%, rgba(255,231,199,0) 60%),
        var(--bg);
    }
    a{color:var(--accent-strong); font-weight:700; text-decoration:none}
    a:hover{text-decoration:underline}
    .wrap{max-width:980px; margin:0 auto}
    .head{display:flex; align-items:center; justify-content:space-between; margin-bottom:16px}
    .title{display:flex; align-items:center; gap:10px}
    .title h1{margin:0; font-size: clamp(22px, 3.2vw, 34px)}
    .okonomi{ width:48px; height:48px }
    .card{
      background:var(--paper);
      border:2px solid var(--ring);
      border-radius:24px;
      padding:18px;
      box-shadow: 0 14px 42px rgba(249,115,22,.12);
    }
    .row{display:flex; gap:10px; flex-wrap:wrap; margin-bottom:12px}
    input,button{font:inherit}
    input{
      flex:1; padding:12px 14px; border-radius:14px; border:2px solid var(--ring);
      background:#fffaf4; color:var(--ink); min-width:220px;
    }
    button{
      padding:12px 16px; border-radius:14px; border:2px solid var(--ring);
      background:linear-gradient(180deg,#fff,#fffaf5); color:var(--ink); cursor:pointer; font-weight:800;
      box-shadow: 0 8px 0 #ffd3a8; transition: transform .06s ease, box-shadow .06s ease;
    }
    button:hover{ transform:translateY(1px); box-shadow:0 4px 0 #ffd3a8 }
    .list{margin-top:12px}
    .item{
      padding:12px 14px; border:2px solid var(--ring); border-radius:14px;
      display:flex; align-items:center; justify-content:space-between; gap:8px; margin-bottom:10px;
      background:#fffdf9;
    }
    .muted{ color:var(--muted); font-size:13px }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="head">
      <div class="title">
        <svg class="okonomi" viewBox="0 0 120 120" aria-hidden="true">
          <ellipse cx="60" cy="70" rx="48" ry="26" fill="#b5651d"/>
          <ellipse cx="60" cy="66" rx="50" ry="28" fill="#d09a58"/>
          <ellipse cx="60" cy="60" rx="44" ry="22" fill="#5a2a13"/>
          <path d="M20,54 C38,49 44,67 60,62 C76,57 82,75 100,70" fill="none" stroke="#fff7df" stroke-width="6" stroke-linecap="round"/>
          <circle cx="46" cy="58" r="2" fill="#2f6b3a"/>
          <circle cx="70" cy="62" r="2" fill="#2f6b3a"/>
          <circle cx="84" cy="56" r="2" fill="#2f6b3a"/>
          <path d="M30,52 q6,-6 12,0 q-6,6 -12,0Z" fill="#ffe6c7" opacity=".8"/>
        </svg>
        <h1>ğŸ³ èª¿ç†å ´</h1>
      </div>
      <div><a href="/">â† æˆ»ã‚‹</a></div>
    </div>

    <div class="card" role="region" aria-label="èª¿ç†ãƒ¡ãƒ¢">
      <p class="muted">é£Ÿæåœ¨åº«ãƒ»ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼ãƒ»æä¾›åœæ­¢/å†é–‹ãªã©ã¯ä»Šå¾Œã“ã“ã¸æ‹¡å¼µã§ãã¾ã™ã€‚ã¾ãšã¯ãƒ¡ãƒ¢ã‹ã‚‰ã€‚</p>
      <div class="row">
        <input id="note" placeholder="ãƒ¡ãƒ¢ï¼ˆä¾‹ï¼šã‚­ãƒ£ãƒ™ãƒ„æ®‹ã‚Šå°‘ãªã„ï¼è±šç‰ä¸€æ™‚åœæ­¢ï¼‰" aria-label="èª¿ç†ãƒ¡ãƒ¢å…¥åŠ›">
        <button id="save" type="button">ãƒ¡ãƒ¢ã‚’è¿½åŠ </button>
      </div>
      <div id="list" class="list" aria-live="polite"></div>
    </div>
  </div>

  <script>
    // æ—¢å­˜ã®æœ€å°å®Ÿè£…ï¼ˆAuth+Firestoreã‚’è¸è¥²ï¼‰
    const listEl = document.getElementById('list');
    document.getElementById('save').addEventListener('click', async () => {
      const user = firebase.auth().currentUser;
      if (!user) { alert('ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„'); return; }
      const note = document.getElementById('note').value.trim();
      if (!note) return;
      try {
        await firebase.firestore().collection('kitchenNotes').add({
          note,
          uid: user.uid,
          createdAt: firebase.firestore.FieldValue.serverTimestamp(),
        });
        document.getElementById('note').value = '';
        loadNotes();
      } catch(e) {
        alert('ä¿å­˜ã«å¤±æ•—: ' + (e?.message || e));
      }
    });

    async function loadNotes() {
      const snap = await firebase.firestore()
        .collection('kitchenNotes')
        .orderBy('createdAt','desc')
        .limit(20)
        .get();
      listEl.innerHTML = snap.docs.map(d => {
        const x = d.data();
        const t = x.createdAt?.toDate?.() || new Date();
        return `<div class="item"><span>${x.note}</span><span class="muted">${t.toLocaleString()}</span></div>`;
      }).join('');
    }

    firebase.auth().onAuthStateChanged(() => loadNotes());
  </script>
</body>
</html>
